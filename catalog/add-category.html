<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title data-i18n="page_title">Nuova Categoria</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../styles.css">

    <!-- MOTORE SPONSOR (Assicurati che sia nella root o aggiusta il path) -->
    <script src="../sponsor.js"></script>

    <style>
        .separator {
            display: flex; align-items: center; text-align: center;
            margin: 20px 0; color: var(--text-muted); font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
        }
        .separator::before, .separator::after {
            content: ''; flex: 1; border-bottom: 1px solid var(--glass-border);
        }
        .separator::before { margin-right: 10px; }
        .separator::after { margin-left: 10px; }

        /* Stile Loader Arricchito */
        #loader {
            background: rgba(15, 23, 42, 0.95); /* Sfondo scuro coprente */
            backdrop-filter: blur(10px);
            z-index: 9999;
        }
        .loader-content {
            width: 90%; max-width: 350px;
            text-align: center;
            background: var(--card-bg);
            padding: 30px; border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    
    <!-- LOADER (Ora con Sponsor) -->
    <div id="loader" class="hidden" style="position: fixed; inset: 0; display: flex; justify-content: center; align-items: center;">
        <div class="loader-content fade-in">
            <div class="spinner-ring" style="width: 40px; height: 40px; margin-bottom: 15px;"></div>
            <h3 id="loader-title" style="margin-bottom: 5px; font-size: 16px;">AI al Lavoro...</h3>
            <div id="loader-text" style="margin-bottom: 20px; font-size: 13px; color: var(--text-muted);">Analisi della richiesta in corso</div>
            
            <!-- SLOT PUBBLICITARIO -->
            <div style="border-top: 1px dashed var(--glass-border); padding-top: 15px; margin-top: 15px;">
                <div style="font-size: 9px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; opacity: 0.5;">Sponsored Partner</div>
                <div id="loader-ad-slot" style="min-height: 80px;"></div>
            </div>
        </div>
    </div>

    <div class="container fade-in" id="app-content">
        
        <h1 data-i18n="title">Nuova Categoria</h1>
        <p class="subtitle" data-i18n="subtitle">Configura la nuova area di business.</p>

        <!-- FASE 1: INPUT UNICO -->
        <div id="inputPhase">
            
            <div class="card">
                <div class="form-group">
                    <label for="categoryName" class="required" data-i18n="lblCatName">Nome Categoria</label>
                    <input type="text" id="categoryName" required placeholder="...">
                </div>
                
                <div class="form-group">
                    <label for="categoryDescription" data-i18n="lblCatDesc">Descrizione (Opzionale)</label>
                    <textarea id="categoryDescription" rows="2" placeholder="..."></textarea>
                </div>

                <div class="separator" data-i18n="divider_text">E / O CARICA LISTINO</div>

                <div class="upload-box enabled" id="file-upload-box" style="padding: 20px;">
                    <input type="file" id="file-input" accept=".pdf,.json,.txt,.csv">
                    <div class="upload-icon" style="font-size: 28px; margin-bottom: 5px;"><i class="fas fa-file-upload"></i></div>
                    <span class="upload-text" id="upload-text" data-i18n="upload_hint">Tocca per caricare File</span>
                    <div id="file-name-display" style="font-size:12px; color:var(--success); margin-top:5px; font-weight:600;"></div>
                </div>
            </div>

            <div class="btn-container">
                <button id="generateBtn" class="btn btn-primary btn-block btn-lg">
                    <i class="fas fa-magic"></i> <span data-i18n="btnGenerate">Genera Servizi</span>
                </button>
            </div>
        </div>

        <!-- FASE 2: REVISIONE -->
        <div id="reviewPhase" class="hidden fade-in">
            <div class="card">
                <h3 data-i18n="subcatTitle" class="section-title">Servizi Rilevati</h3>
                <ul id="subcategoriesList" style="list-style: none; margin-bottom: 20px; padding: 0;"></ul>
                
                <div class="input-group">
                    <label data-i18n="lblManualAdd">Aggiungi Manualmente</label>
                    <div class="d-flex gap-2">
                        <input type="text" id="manualSubcat" placeholder="">
                        <button id="addSubcatBtn" class="btn btn-secondary btn-icon" style="border-radius: var(--radius-md);">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- âš ï¸ Rimosso bottone inline, ora usa FAB -->
            <div style="height: 80px;"></div>
        </div>

    </div>

    <!-- ðŸ‘‰ FAB CONTAINER: Bottone Indietro sempre visibile, Salva solo in fase 2 -->
    <div class="fab-container">
        <button class="fab-btn fab-secondary" onclick="history.back()" title="Torna Indietro">
            <i class="fas fa-arrow-left"></i>
        </button>
        
        <!-- Bottone Salva: nascosto di default, mostrato dal JS nella fase 2 -->
        <button class="fab-btn hidden" id="saveBtn" title="Salva Categoria">
            <i class="fas fa-save"></i>
        </button>
    </div>

    <script src="add-category_logic.js"></script>
</body>
</html>
