<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Blueprint Editor</title>
  
  <!-- Telegram WebApp -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- SortableJS per Drag & Drop -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Stile Unificato -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- LOADING OVERLAY -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="spinner"></div>
    <div class="loading-text" id="txtLoading">Loading...</div>
  </div>

  <div class="container hidden" id="mainContent">
    <h1 id="pageTitle">Blueprint</h1>
    <p class="subtitle" id="pageSubtitle">Define Process</p>
    
    <form id="blueprintForm">
      
      <!-- INFO SECTION -->
      <div class="form-section">
        <div class="form-section-title" id="lblInfo">Info</div>
        <div class="form-group">
          <label class="disabled">SKU</label>
          <input type="text" id="serviceSku" disabled>
        </div>
        <div class="form-group">
          <label id="lblDesc">Description</label>
          <textarea id="blueprintDesc" rows="2" placeholder="..."></textarea>
        </div>
      </div>

      <!-- STAGES CONTAINER -->
      <div class="form-section-title" id="lblStages">Stages</div>
      <div id="stagesContainer"></div>

      <!-- ADD STAGE BUTTON -->
      <div class="btn-container">
        <button type="button" class="btn btn-secondary btn-block" onclick="addStage()">
          <i class="fas fa-plus"></i> <span id="btnAddStage">Add Stage</span>
        </button>
      </div>

      <!-- SUBMIT BUTTON -->
      <div class="btn-container" style="margin-top: 40px;">
        <button type="submit" class="btn btn-primary btn-block" id="saveBtn">
          <i class="fas fa-save"></i> Save
        </button>
      </div>
      <p class="cancel-hint" id="cancelHint"></p>
    </form>
  </div>

  <script>
    const WEBHOOK_URL = "https://trinai.api.workflow.dcmake.it/webhook/e742c7c8-107e-4328-882e-c13459413424";
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TRANSLATIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const translations = {
      it: {
        title: "ğŸ“‹ Blueprint Operativo", subtitle: "Trascina per riordinare fasi e step.",
        lblInfo: "â„¹ï¸ Info Generali", lblDesc: "Descrizione", lblStages: "ğŸ¯ Fasi Operative",
        btnAddStage: "Aggiungi Fase", btnSave: "Salva Blueprint", 
        loading: "Caricamento...", saving: "Salvataggio...", saved: "âœ… Salvato!", error: "âŒ Errore",
        phDesc: "Scopo del processo...", phStageDesc: "Descrizione fase...", phStepInstr: "Istruzioni...",
        lblQC: "Controllo QualitÃ ", phQC: "Cosa verificare?",
        lblSkills: "Skill (CSV)", phSkills: "Es: Dev, Legal...",
        newStage: "Nuova Fase", newStep: "Nuovo Step",
        confirmDelStage: "Eliminare fase?", confirmDelStep: "Eliminare step?",
        btnAddStep: "Aggiungi Step", min: "min",
        lblLogistics: "Logistica & Risorse",
        flagWIP: "Richiede Semilavorato",
        flagFinished: "Richiede Prodotto Finito",
        cancelHint: "Per annullare, chiudi la finestra."
      },
      en: {
        title: "ğŸ“‹ Operational Blueprint", subtitle: "Drag to reorder stages and steps.",
        lblInfo: "â„¹ï¸ General Info", lblDesc: "Description", lblStages: "ğŸ¯ Operational Stages",
        btnAddStage: "Add Stage", btnSave: "Save Blueprint", 
        loading: "Loading...", saving: "Saving...", saved: "âœ… Saved!", error: "âŒ Error",
        phDesc: "Process purpose...", phStageDesc: "Stage description...", phStepInstr: "Instructions...",
        lblQC: "Quality Check", phQC: "Verify what?",
        lblSkills: "Skills (CSV)", phSkills: "E.g.: Dev, Legal...",
        newStage: "New Stage", newStep: "New Step",
        confirmDelStage: "Delete stage?", confirmDelStep: "Delete step?",
        btnAddStep: "Add Step", min: "min",
        lblLogistics: "Logistics & Resources",
        flagWIP: "Requires Semi-finished (WIP)",
        flagFinished: "Requires Finished Product",
        cancelHint: "To cancel, close the window."
      },
      fr: {
        title: "ğŸ“‹ Blueprint", subtitle: "Glisser pour rÃ©organiser.",
        lblInfo: "â„¹ï¸ Info", lblDesc: "Description", lblStages: "ğŸ¯ Phases",
        btnAddStage: "Ajouter Phase", btnSave: "Enregistrer", 
        loading: "Chargement...", saving: "Enregistrement...", saved: "âœ… EnregistrÃ© !", error: "âŒ Erreur",
        phDesc: "But du processus...", phStageDesc: "Desc. phase...", phStepInstr: "Instructions...",
        lblQC: "ContrÃ´le QualitÃ©", phQC: "Quoi vÃ©rifier ?",
        lblSkills: "CompÃ©tences", phSkills: "Ex: Dev...",
        newStage: "Nouvelle Phase", newStep: "Nouvelle Ã‰tape",
        confirmDelStage: "Supprimer phase ?", confirmDelStep: "Supprimer Ã©tape ?",
        btnAddStep: "Ajouter Ã‰tape", min: "min",
        lblLogistics: "Logistique & Ressources",
        flagWIP: "NÃ©cessite Produit Semi-fini",
        flagFinished: "NÃ©cessite Produit Fini",
        cancelHint: "Pour annuler, fermez la fenÃªtre."
      },
      de: {
        title: "ğŸ“‹ Blueprint", subtitle: "Ziehen zum Neuordnen.",
        lblInfo: "â„¹ï¸ Info", lblDesc: "Beschreibung", lblStages: "ğŸ¯ Phasen",
        btnAddStage: "Phase hinzufÃ¼gen", btnSave: "Speichern", 
        loading: "Laden...", saving: "Speichern...", saved: "âœ… Gespeichert!", error: "âŒ Fehler",
        phDesc: "Zweck...", phStageDesc: "Beschreibung...", phStepInstr: "Anweisungen...",
        lblQC: "QualitÃ¤t", phQC: "PrÃ¼fen?",
        lblSkills: "Skills", phSkills: "z.B. Dev...",
        newStage: "Neue Phase", newStep: "Neuer Schritt",
        confirmDelStage: "Phase lÃ¶schen?", confirmDelStep: "Schritt lÃ¶schen?",
        btnAddStep: "Schritt hinzufÃ¼gen", min: "Min",
        lblLogistics: "Logistik & Ressourcen",
        flagWIP: "BenÃ¶tigt Halbzeug",
        flagFinished: "BenÃ¶tigt Fertigprodukt",
        cancelHint: "Zum Abbrechen Fenster schlieÃŸen."
      },
      es: {
        title: "ğŸ“‹ Blueprint", subtitle: "Arrastrar para reordenar.",
        lblInfo: "â„¹ï¸ Info", lblDesc: "DescripciÃ³n", lblStages: "ğŸ¯ Fases",
        btnAddStage: "AÃ±adir Fase", btnSave: "Guardar", 
        loading: "Cargando...", saving: "Guardando...", saved: "âœ… Guardado", error: "âŒ Error",
        phDesc: "PropÃ³sito...", phStageDesc: "Desc. fase...", phStepInstr: "Instrucciones...",
        lblQC: "Calidad", phQC: "Â¿Verificar quÃ©?",
        lblSkills: "Habilidades", phSkills: "Ej: Dev...",
        newStage: "Nueva Fase", newStep: "Nuevo Paso",
        confirmDelStage: "Â¿Borrar fase?", confirmDelStep: "Â¿Borrar paso?",
        btnAddStep: "AÃ±adir Paso", min: "min",
        lblLogistics: "LogÃ­stica & Recursos",
        flagWIP: "Requiere Semielaborado",
        flagFinished: "Requiere Producto Terminado",
        cancelHint: "Para cancelar, cierra la ventana."
      },
      pt: {
        title: "ğŸ“‹ Blueprint", subtitle: "Arraste para reordenar.",
        lblInfo: "â„¹ï¸ Info", lblDesc: "DescriÃ§Ã£o", lblStages: "ğŸ¯ Fases",
        btnAddStage: "Adicionar Fase", btnSave: "Salvar", 
        loading: "Carregando...", saving: "Salvando...", saved: "âœ… Salvo!", error: "âŒ Erro",
        phDesc: "PropÃ³sito...", phStageDesc: "Desc. fase...", phStepInstr: "InstruÃ§Ãµes...",
        lblQC: "Qualidade", phQC: "Verificar o quÃª?",
        lblSkills: "Habilidades", phSkills: "Ex: Dev...",
        newStage: "Nova Fase", newStep: "Novo Passo",
        confirmDelStage: "Excluir fase?", confirmDelStep: "Excluir passo?",
        btnAddStep: "Adicionar Passo", min: "min",
        lblLogistics: "LogÃ­stica & Recursos",
        flagWIP: "Requer Semiacabado",
        flagFinished: "Requer Produto Acabado",
        cancelHint: "Para cancelar, feche a janela."
      }
    };

    const p = new URLSearchParams(location.search);
    const langCode = p.get('lang') || p.get('language') || 'it';
    const t = translations[langCode] || translations.it;
    const blueprintId = p.get('id');
    const ownerId = p.get('owner');
    
    let currentData = null;

    // Apply Static Translations
    document.getElementById('pageTitle').textContent = t.title;
    document.getElementById('pageSubtitle').textContent = t.subtitle;
    document.getElementById('lblInfo').textContent = t.lblInfo;
    document.getElementById('lblDesc').textContent = t.lblDesc;
    document.getElementById('blueprintDesc').placeholder = t.phDesc;
    document.getElementById('lblStages').textContent = t.lblStages;
    document.getElementById('btnAddStage').innerHTML = `<i class="fas fa-plus"></i> ${t.btnAddStage}`;
    document.getElementById('saveBtn').innerHTML = `<i class="fas fa-save"></i> ${t.btnSave}`;
    document.getElementById('txtLoading').textContent = t.loading;
    document.getElementById('cancelHint').textContent = t.cancelHint;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LOGIC & RENDER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function updateIndexes() {
      if (!currentData || !currentData.stages) return;
      let totalMinutes = 0;
      currentData.stages.forEach((stage, sIdx) => {
        stage.stage_order = sIdx + 1;
        stage.stage_id = `STAGE_${String(sIdx + 1).padStart(2, '0')}`;
        if (!stage.steps) stage.steps = [];
        stage.steps.forEach((step, stIdx) => {
          step.step_order = stIdx + 1;
          step.step_id = `STEP_${String(sIdx + 1).padStart(2, '0')}_${String(stIdx + 1).padStart(2, '0')}`;
          totalMinutes += parseInt(step.estimated_time_minutes || 0);
        });
      });
      if (!currentData.summary) currentData.summary = {};
      currentData.summary.estimated_total_time_minutes = totalMinutes;
    }

    function renderStages() {
      const container = document.getElementById('stagesContainer');
      container.innerHTML = '';

      currentData.stages.forEach((stage, sIdx) => {
        const stageCard = document.createElement('div');
        stageCard.className = 'stage-card'; // Style from CSS
        stageCard.dataset.idx = sIdx;

        stageCard.innerHTML = `
          <div class="stage-header">
            <div class="drag-handle"><i class="fas fa-grip-vertical"></i></div>
            <div class="stage-content">
              <div>${stage.stage_id}</div>
              <input type="text" class="stage-title-input" value="${stage.stage_name}" 
                     onchange="updateData('stages[${sIdx}].stage_name', this.value)">
              <textarea 
                        onchange="updateData('stages[${sIdx}].description', this.value)" placeholder="${t.phStageDesc}">${stage.description || ''}</textarea>
            </div>
            <button type="button" class="btn-icon btn-delete" onclick="removeStage(${sIdx})"><i class="fas fa-trash"></i></button>
          </div>
          
          <div class="step-list-container" id="stepList-${sIdx}"></div>
          
          <div class="text-center mt-2">
            <button type="button" class="btn btn-sm btn-secondary" onclick="addStep(${sIdx})">
                <i class="fas fa-plus"></i> ${t.btnAddStep}
            </button>
          </div>
        `;

        const stepListContainer = stageCard.querySelector(`#stepList-${sIdx}`);
        
        if (stage.steps && stage.steps.length > 0) {
          stage.steps.forEach((step, stIdx) => {
            const stepItem = document.createElement('div');
            stepItem.className = 'step-item'; // Style from CSS
            stepItem.dataset.idx = stIdx;

            const flags = step.logistics_flags || { requires_wip: false, requires_finished: false };
            const isOpen = step._ui_open ? 'open' : ''; // State persistence for UI

            stepItem.innerHTML = `
              <div class="step-header">
                <div class="drag-handle"><i class="fas fa-grip-lines"></i></div>
                <div style="flex:1">
                  <span class="step-id">${step.step_id}</span>
                  <input type="text" class="step-name-input" value="${step.step_name}"
                         onchange="updateData('stages[${sIdx}].steps[${stIdx}].step_name', this.value)">
                  <textarea 
                            onchange="updateData('stages[${sIdx}].steps[${stIdx}].instructions', this.value)" placeholder="${t.phStepInstr}">${step.instructions || ''}</textarea>
                  <div class="step-meta">
                    <span class="meta-item">
                      â±ï¸ <input type="number" min="0" style="width:50px; display:inline-block;"
                               value="${step.estimated_time_minutes || 0}"
                               onchange="updateData('stages[${sIdx}].steps[${stIdx}].estimated_time_minutes', this.value)"> ${t.min}
                    </span>
                  </div>
                </div>
                <div style="display:flex; flex-direction:column; gap:5px;">
                  <button type="button" class="btn-icon btn-delete" onclick="removeStep(${sIdx}, ${stIdx})"><i class="fas fa-trash"></i></button>
                  <button type="button" class="btn-icon" onclick="toggleStep(${sIdx}, ${stIdx})">
                    ${step.quality_check?.check_description ? '<i class="fas fa-clipboard-check" style="color:var(--success)"></i>' : '<i class="fas fa-cog"></i>'}
                  </button>
                </div>
              </div>
              
              <div class="collapsible-content ${isOpen}" id="step-${sIdx}-${stIdx}">
                
                  <div class="flag-container">
                    <div class="checkbox-group">
                        <label>
                        <input type="checkbox" ${flags.requires_wip ? 'checked' : ''} 
                                onchange="updateFlag(${sIdx}, ${stIdx}, 'requires_wip', this.checked)">
                        ğŸ­ ${t.flagWIP}
                        </label>
                        <label>
                        <input type="checkbox" ${flags.requires_finished ? 'checked' : ''} 
                                onchange="updateFlag(${sIdx}, ${stIdx}, 'requires_finished', this.checked)">
                        ğŸ“¦ ${t.flagFinished}
                        </label>
                    </div>
                  </div>

                  <div class="form-group">
                    <label>${t.lblQC}</label>
                    <textarea 
                              onchange="updateNestedData(${sIdx}, ${stIdx}, 'quality_check.check_description', this.value)"
                              placeholder="${t.phQC}">${step.quality_check?.check_description || ''}</textarea>
                  </div>
                  <div class="form-group">
                    <label>${t.lblSkills}</label>
                    <input type="text" 
                           value="${(step.resources_needed?.labor?.required_skill_tags || []).join(', ')}"
                           onchange="updateSkills(${sIdx}, ${stIdx}, this.value)"
                           placeholder="${t.phSkills}">
                  </div>
                
              </div>
            `;
            stepListContainer.appendChild(stepItem);
          });
        }
        
        new Sortable(stepListContainer, {
          group: 'steps', handle: '.drag-handle', animation: 150, ghostClass: 'sortable-ghost',
          onEnd: function (evt) {
            const fromStageIdx = parseInt(evt.from.closest('.stage-card').dataset.idx);
            const toStageIdx = parseInt(evt.to.closest('.stage-card').dataset.idx);
            const movedItem = currentData.stages[fromStageIdx].steps.splice(evt.oldIndex, 1)[0];
            currentData.stages[toStageIdx].steps.splice(evt.newIndex, 0, movedItem);
            updateIndexes(); renderStages();
          }
        });
        container.appendChild(stageCard);
      });

      new Sortable(container, {
        handle: '.drag-handle', animation: 150, ghostClass: 'sortable-ghost',
        onEnd: function (evt) {
          const movedItem = currentData.stages.splice(evt.oldIndex, 1)[0];
          currentData.stages.splice(evt.newIndex, 0, movedItem);
          updateIndexes(); renderStages();
        }
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // HELPERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    window.updateData = function(path, value) {
        let obj = currentData;
        const keys = path.replace(/\]/g, '').split(/[\[\.]/); 
        keys.forEach((key, index) => {
            if (index === keys.length - 1) {
                if (key === 'estimated_time_minutes') value = parseInt(value) || 0;
                obj[key] = value;
            } else { obj = obj[key]; }
        });
        if(path.includes('estimated_time_minutes')) updateIndexes();
    };

    window.updateNestedData = function(sIdx, stIdx, keyPath, value) {
        let target = currentData.stages[sIdx].steps[stIdx];
        const keys = keyPath.split('.');
        if (keys[0] === 'quality_check' && !target.quality_check) target.quality_check = {};
        keys.forEach((key, index) => {
            if (index === keys.length - 1) target[key] = value; else target = target[key];
        });
    };

    window.updateFlag = function(sIdx, stIdx, flagName, isChecked) {
        let target = currentData.stages[sIdx].steps[stIdx];
        if (!target.logistics_flags) target.logistics_flags = {};
        target.logistics_flags[flagName] = isChecked;
    };

    window.updateSkills = function(sIdx, stIdx, value) {
        const tags = value.split(',').map(t => t.trim()).filter(t => t);
        if (!currentData.stages[sIdx].steps[stIdx].resources_needed) currentData.stages[sIdx].steps[stIdx].resources_needed = { labor: {} };
        if (!currentData.stages[sIdx].steps[stIdx].resources_needed.labor) currentData.stages[sIdx].steps[stIdx].resources_needed.labor = {};
        currentData.stages[sIdx].steps[stIdx].resources_needed.labor.required_skill_tags = tags;
    };

    window.addStage = function() {
      currentData.stages.push({ stage_id: "", stage_order: 0, stage_name: t.newStage, description: "", steps: [] });
      updateIndexes(); renderStages();
      setTimeout(() => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }), 100);
    };

    window.removeStage = function(index) {
      if(confirm(t.confirmDelStage)) { currentData.stages.splice(index, 1); updateIndexes(); renderStages(); }
    };

    window.addStep = function(stageIndex) {
      currentData.stages[stageIndex].steps.push({ 
        step_id: "", step_order: 0, step_name: t.newStep, instructions: "", estimated_time_minutes: 15, 
        resources_needed: { labor: { required_skill_tags: [] }, materials: [], assets: [] }, 
        quality_check: null,
        logistics_flags: { requires_wip: false, requires_finished: false },
        _ui_open: true // Open by default when adding
      });
      updateIndexes(); renderStages();
    };

    window.removeStep = function(sIdx, stIdx) {
      if(confirm(t.confirmDelStep)) { currentData.stages[sIdx].steps.splice(stIdx, 1); updateIndexes(); renderStages(); }
    };

    window.toggleStep = function(sIdx, stIdx) {
      const step = currentData.stages[sIdx].steps[stIdx];
      step._ui_open = !step._ui_open; // Toggle state in data model to persist across re-renders
      
      const el = document.getElementById(`step-${sIdx}-${stIdx}`);
      if(el) {
          el.classList.toggle('open');
      }
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // NETWORK
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadBlueprint() {
      try {
        const res = await fetch(WEBHOOK_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'GET', type: 'BLUEPRINT', id: blueprintId, owner_id: ownerId }) });
        let data;
        const text = await res.text();
        try { data = JSON.parse(text); } catch (e) { data = JSON.parse(text.replace(/^"|"$/g, '').replace(/\\"/g, '"')); }
        currentData = data;
        
        // Ensure stages exists
        if(!currentData.stages) currentData.stages = [];

        document.getElementById('serviceSku').value = data.service_sku || '';
        document.getElementById('blueprintDesc').value = data.blueprint_description || '';
        updateIndexes(); renderStages();
        document.getElementById('loadingOverlay').classList.add('hidden');
        document.getElementById('mainContent').classList.remove('hidden');
      } catch (error) { 
          document.getElementById('txtLoading').textContent = t.error; 
          console.error(error);
      }
    }

    document.getElementById('blueprintForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('saveBtn');
      const originalText = btn.innerHTML;
      btn.innerHTML = `<div class="spinner" style="width:20px;height:20px;border-width:2px;"></div> ${t.saving}`;
      btn.disabled = true;
      
      currentData.blueprint_description = document.getElementById('blueprintDesc').value.trim();
      
      // Clean up internal UI flags before saving
      const cleanData = JSON.parse(JSON.stringify(currentData));
      cleanData.stages.forEach(s => s.steps.forEach(st => delete st._ui_open));
      
      updateIndexes();
      try {
        await fetch(WEBHOOK_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'SAVE', type: 'BLUEPRINT', id: blueprintId, owner_id: ownerId, payload: cleanData }) });
        btn.innerHTML = `<i class="fas fa-check"></i> ${t.saved}`;
        btn.classList.add('btn-success');
        setTimeout(() => tg.close(), 1000);
      } catch (error) { 
          btn.innerHTML = `<i class="fas fa-times"></i> ${t.error}`; 
          btn.classList.add('btn-delete');
          setTimeout(() => {
              btn.disabled = false;
              btn.innerHTML = originalText;
              btn.classList.remove('btn-delete');
          }, 3000);
      }
    });

    loadBlueprint();
  </script>
</body>
</html>
