<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>SiteBoS Enterprise Setup</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- Font Inter per look professionale -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --bg-dark: #0f172a; --bg-card: #1e293b; 
      --text-main: #f1f5f9; --text-muted: #94a3b8;
      --primary: #3b82f6; --primary-hover: #2563eb;
      --success: #10b981; --error: #ef4444;
      --border: rgba(255, 255, 255, 0.1);
      --glass: rgba(30, 41, 59, 0.7);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-main);
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
      padding: 20px;
    }

    /* --- LAYOUT & CONTAINERS --- */
    .container { width: 100%; max-width: 600px; padding-bottom: 60px; position: relative; }
    
    .hidden { display: none !important; }
    .fade-in { animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* --- WIZARD PROGRESS --- */
    .wizard-header { margin-bottom: 30px; text-align: center; }
    .progress-bar { display: flex; justify-content: space-between; position: relative; margin-bottom: 40px; padding: 0 10px; }
    .progress-line { position: absolute; top: 14px; left: 0; right: 0; height: 2px; background: var(--border); z-index: 0; }
    .progress-fill { position: absolute; top: 14px; left: 0; height: 2px; background: var(--primary); z-index: 0; transition: width 0.4s; width: 0%; }
    
    .step-item { z-index: 1; display: flex; flex-direction: column; align-items: center; gap: 8px; width: 60px; }
    .step-circle { width: 30px; height: 30px; border-radius: 50%; background: var(--bg-card); border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; transition: all 0.3s; }
    .step-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
    
    .step-item.active .step-circle { border-color: var(--primary); background: var(--primary); color: white; box-shadow: 0 0 15px rgba(59, 130, 246, 0.4); }
    .step-item.completed .step-circle { border-color: var(--success); background: var(--success); color: white; }
    .step-item.active .step-label { color: var(--text-main); }

    /* --- FORMS & INPUTS --- */
    h2 { font-size: 20px; font-weight: 700; margin-bottom: 8px; color: white; }
    p.subtitle { font-size: 14px; color: var(--text-muted); margin-bottom: 24px; line-height: 1.5; }

    .input-group { margin-bottom: 16px; }
    label { display: block; font-size: 13px; font-weight: 500; color: var(--text-muted); margin-bottom: 6px; }
    .required::after { content: "*"; color: var(--error); margin-left: 4px; }
    
    input, select {
      width: 100%; padding: 14px; background: rgba(255,255,255,0.03);
      border: 1px solid var(--border); border-radius: 12px;
      color: white; font-family: inherit; font-size: 15px;
      transition: border 0.2s, background 0.2s;
    }
    input:focus, select:focus { outline: none; border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }
    
    .row { display: flex; gap: 12px; }
    .col { flex: 1; } .col-2 { flex: 2; } .col-3 { flex: 3; }

    /* --- UPLOAD BOX --- */
    .upload-box {
      border: 2px dashed var(--border); border-radius: 12px;
      padding: 25px; text-align: center; cursor: pointer;
      background: rgba(255,255,255,0.02); transition: all 0.3s;
      position: relative;
    }
    .upload-box:hover { border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }
    .upload-box.has-file { border-color: var(--success); background: rgba(16, 185, 129, 0.05); }
    .upload-icon { font-size: 24px; margin-bottom: 8px; display: block; }
    .upload-text { font-size: 13px; color: var(--text-muted); }
    input[type="file"] { position: absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer; }

    /* --- PRICING CARDS --- */
    .plan-card {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 16px; padding: 20px; margin-bottom: 12px;
      cursor: pointer; display: flex; justify-content: space-between; align-items: center;
      transition: all 0.2s;
    }
    .plan-card.selected { border-color: var(--primary); background: rgba(59, 130, 246, 0.1); }
    .plan-price { font-size: 20px; font-weight: 700; }
    .plan-detail { font-size: 13px; color: var(--text-muted); }

    /* --- COMPLIANCE --- */
    .checkbox-group { display: flex; gap: 12px; align-items: flex-start; margin-bottom: 12px; padding: 10px; background: rgba(255,255,255,0.03); border-radius: 8px; }
    .checkbox-group input { width: 20px; height: 20px; margin-top: 2px; cursor: pointer; }
    .checkbox-label { font-size: 12px; line-height: 1.4; color: var(--text-muted); cursor: pointer; }
    .checkbox-label a { color: var(--primary); text-decoration: none; }

    /* --- BUTTONS --- */
    .btn-container { margin-top: 30px; display: flex; gap: 15px; }
    .btn {
      flex: 1; padding: 16px; border-radius: 12px; font-weight: 600; font-size: 15px;
      cursor: pointer; border: none; transition: transform 0.1s;
    }
    .btn:active { transform: scale(0.98); }
    .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }
    .btn-secondary { background: transparent; border: 1px solid var(--border); color: var(--text-muted); }
    
    /* --- SCREENS --- */
    #access-denied { text-align: center; margin-top: 20vh; }
    .btn-block { width: 100%; display: block; text-align: center; text-decoration: none; }

  </style>
</head>
<body>

  <!-- LOADING SCREEN -->
  <div id="loader" style="position:fixed; inset:0; background:var(--bg-dark); z-index:99; display:flex; justify-content:center; align-items:center; flex-direction:column;">
    <div style="width:40px; height:40px; border:4px solid rgba(255,255,255,0.1); border-top-color:var(--primary); border-radius:50%; animation:spin 0.8s linear infinite;"></div>
    <div style="margin-top:15px; font-size:12px; color:var(--text-muted);">Security Check...</div>
  </div>
  <style>@keyframes spin { to { transform: rotate(360deg); } }</style>

  <!-- ACCESS DENIED -->
  <div id="access-denied" class="hidden">
    <div style="font-size:48px; margin-bottom:20px;">ðŸ”’</div>
    <h2 data-i18n="access_denied_title">Accesso Negato</h2>
    <p class="subtitle" data-i18n="access_denied_desc">Questa interfaccia Ã¨ disponibile solo tramite il Bot ufficiale.</p>
    <a href="https://t.me/TrinAi_SiteBoS_bot" class="btn btn-primary btn-block" data-i18n="open_bot">Apri Bot</a>
  </div>

  <!-- MAIN APP -->
  <div id="app-content" class="container hidden">
    
    <div class="wizard-header">
      <div class="input-group">
        <select id="lang-selector" onchange="changeLanguage(this.value)" style="width:auto; padding:8px 12px; font-size:13px;">
          <option value="it">ðŸ‡®ðŸ‡¹ Italiano</option>
          <option value="en">ðŸ‡¬ðŸ‡§ English</option>
          <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
          <option value="de">ðŸ‡©ðŸ‡ª Deutsch</option>
          <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
          <option value="pt">ðŸ‡µðŸ‡¹ PortuguÃªs</option>
        </select>
      </div>
    </div>

    <!-- PROGRESS BAR -->
    <div class="progress-bar">
      <div class="progress-line"></div>
      <div class="progress-fill" id="progress-fill"></div>
      
      <div class="step-item active" id="si-1">
        <div class="step-circle">1</div>
        <div class="step-label" data-i18n="step_identity">IdentitÃ </div>
      </div>
      <div class="step-item" id="si-2">
        <div class="step-circle">2</div>
        <div class="step-label" data-i18n="step_company">Azienda</div>
      </div>
      <div class="step-item" id="si-3">
        <div class="step-circle">3</div>
        <div class="step-label" data-i18n="step_plan">Piano</div>
      </div>
      <div class="step-item" id="si-4">
        <div class="step-circle">4</div>
        <div class="step-label" data-i18n="step_checkout">Checkout</div>
      </div>
    </div>

    <form id="wizardForm">
      
      <!-- STEP 1: IDENTITY (KYC) -->
      <div class="step-content fade-in" id="step-1">
        <h2 data-i18n="h_identity">Verifica IdentitÃ </h2>
        <p class="subtitle" data-i18n="sub_identity">Inserisci i dati del referente amministrativo per il KYC.</p>

        <div class="row">
          <div class="col">
            <label class="required" data-i18n="lbl_name">Nome</label>
            <input type="text" id="name" required>
          </div>
          <div class="col">
            <label class="required" data-i18n="lbl_surname">Cognome</label>
            <input type="text" id="surname" required>
          </div>
        </div>

        <div class="input-group">
          <label class="required" data-i18n="lbl_email">Email (Login Admin)</label>
          <input type="email" id="email" required>
        </div>

        <div class="input-group">
          <label class="required" data-i18n="lbl_phone">Cellulare</label>
          <input type="tel" id="phone" required>
        </div>

        <!-- ID UPLOAD FOR AI CHECK -->
        <div class="input-group">
          <label class="required" data-i18n="lbl_id_card">Documento d'IdentitÃ  (Fronte)</label>
          <div class="upload-box" id="id-upload-box">
            <input type="file" id="id_document" accept="image/*,application/pdf" required>
            <span class="upload-icon">ðŸªª</span>
            <span class="upload-text" id="id-upload-text" data-i18n="upload_hint">Tocca per caricare foto o PDF</span>
          </div>
          <div style="font-size:11px; color:var(--text-muted); margin-top:6px;" data-i18n="ai_check_note">
            ðŸ¤– L'AI verificherÃ  la corrispondenza dei dati.
          </div>
        </div>

        <div class="btn-container">
          <button type="button" class="btn btn-primary" onclick="nextStep(2)" data-i18n="btn_next">Avanti</button>
        </div>
      </div>

      <!-- STEP 2: COMPANY -->
      <div class="step-content hidden fade-in" id="step-2">
        <h2 data-i18n="h_company">Profilo Aziendale</h2>
        <p class="subtitle" data-i18n="sub_company">Dati per la fatturazione elettronica e configurazione istanza.</p>

        <div class="input-group">
          <label class="required" data-i18n="lbl_company_name">Ragione Sociale</label>
          <input type="text" id="ragione_sociale" placeholder="TrinAI S.r.l." required>
        </div>

        <div class="row">
          <div class="col">
            <label class="required" data-i18n="lbl_vat">Partita IVA</label>
            <input type="text" id="vat_number" required>
          </div>
          <div class="col">
            <label data-i18n="lbl_sdi">SDI / PEC</label>
            <input type="text" id="sdi_pec">
          </div>
        </div>

        <div class="input-group" style="margin-top:15px;">
           <label class="required" data-i18n="lbl_address">Sede Legale</label>
           <div class="row" style="margin-bottom:8px;">
             <div class="col-3"><input type="text" id="addr_route" placeholder="Via/Piazza" required></div>
             <div class="col"><input type="text" id="addr_num" placeholder="NÂ°" required></div>
           </div>
           <div class="row">
             <div class="col"><input type="text" id="addr_zip" placeholder="CAP" required></div>
             <div class="col-2"><input type="text" id="addr_city" placeholder="CittÃ " required></div>
             <div class="col"><input type="text" id="addr_prov" placeholder="PR" maxlength="2" style="text-transform:uppercase" required></div>
           </div>
        </div>

        <div class="input-group">
          <label data-i18n="lbl_site">Sito Web</label>
          <input type="url" id="site" placeholder="https://...">
        </div>

        <div class="btn-container">
          <button type="button" class="btn btn-secondary" onclick="nextStep(1)" data-i18n="btn_back">Indietro</button>
          <button type="button" class="btn btn-primary" onclick="nextStep(3)" data-i18n="btn_next">Avanti</button>
        </div>
      </div>

      <!-- STEP 3: PLAN -->
      <div class="step-content hidden fade-in" id="step-3">
        <h2 data-i18n="h_plan">Scegli il Piano</h2>
        <p class="subtitle" data-i18n="sub_plan">SaaS Enterprise scalabile. Disdici quando vuoi.</p>

        <div class="plan-card selected" onclick="selectPlan('monthly', this)" id="plan-m">
           <div>
             <div style="font-weight:600">SiteBoS Pro (Mensile)</div>
             <div class="plan-detail" data-i18n="plan_monthly_desc">Fatturazione mensile</div>
           </div>
           <div class="plan-price">â‚¬99<span style="font-size:12px">/mo</span></div>
        </div>

        <div class="plan-card" onclick="selectPlan('yearly', this)" id="plan-y">
           <div>
             <div style="font-weight:600">SiteBoS Pro (Annuale)</div>
             <div class="plan-detail" style="color:var(--success)" data-i18n="plan_yearly_desc">Risparmia il 20%</div>
           </div>
           <div class="plan-price">â‚¬950<span style="font-size:12px">/yr</span></div>
        </div>
        
        <input type="hidden" id="selected_plan" value="monthly">

        <div class="btn-container">
          <button type="button" class="btn btn-secondary" onclick="nextStep(2)" data-i18n="btn_back">Indietro</button>
          <button type="button" class="btn btn-primary" onclick="nextStep(4)" data-i18n="btn_next">Avanti</button>
        </div>
      </div>

      <!-- STEP 4: COMPLIANCE & CHECKOUT -->
      <div class="step-content hidden fade-in" id="step-4">
        <h2 data-i18n="h_checkout">Conferma e Pagamento</h2>
        <p class="subtitle" data-i18n="sub_checkout">Accetta le condizioni per procedere al pagamento sicuro.</p>

        <div style="background:var(--bg-card); border-radius:12px; padding:15px; margin-bottom:20px; border:1px solid var(--border);">
            <div style="font-size:13px; color:var(--text-muted); margin-bottom:5px;" data-i18n="summary_plan">Piano Selezionato</div>
            <div style="font-size:18px; font-weight:700; color:white;" id="summary-price">â‚¬99 / mese</div>
        </div>

        <!-- LEGAL CHECKBOXES -->
        <div class="checkbox-group">
            <input type="checkbox" id="check_privacy" required>
            <label for="check_privacy" class="checkbox-label" data-i18n="legal_privacy">
                Dichiaro di aver letto e accettato la <a href="https://trinai.it/compliance/privacy" target="_blank">Privacy Policy</a> e acconsento al trattamento dei dati personali (GDPR).
            </label>
        </div>

        <div class="checkbox-group">
            <input type="checkbox" id="check_terms" required>
            <label for="check_terms" class="checkbox-label" data-i18n="legal_terms">
                Accetto i <a href="https://trinai.it/compliance/policy" target="_blank">Termini e Condizioni</a> di fornitura del servizio SaaS SiteBoS Enterprise.
            </label>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="check_ai" required>
            <label for="check_ai" class="checkbox-label" data-i18n="legal_ai">
                Autorizzo l'analisi AI dei documenti caricati per finalitÃ  di verifica identitÃ  (KYC) e configurazione istanza.
            </label>
        </div>

        <div class="btn-container">
          <button type="button" class="btn btn-secondary" onclick="nextStep(3)" data-i18n="btn_back">Indietro</button>
          <button type="submit" class="btn btn-primary" id="submitBtn" data-i18n="btn_pay">ðŸ”’ Paga e Attiva</button>
        </div>
      </div>

    </form>
  </div>

  <script>
    // --- CONFIG ---
    const WEBHOOK_URL = "https://trinai.api.workflow.dcmake.it/webhook/83acc670-15ae-4da0-ae0e-3587c85bd5f4";
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();

    // --- I18N DICTIONARY ---
    const i18n = {
      it: {
        access_denied_title: "Accesso Negato", access_denied_desc: "Questa interfaccia Ã¨ disponibile solo tramite il Bot.", open_bot: "Apri Bot",
        step_identity: "IdentitÃ ", step_company: "Azienda", step_plan: "Piano", step_checkout: "Checkout",
        h_identity: "Verifica IdentitÃ ", sub_identity: "Dati del referente per il KYC.",
        lbl_name: "Nome", lbl_surname: "Cognome", lbl_email: "Email (Login Admin)", lbl_phone: "Cellulare",
        lbl_id_card: "Documento IdentitÃ ", upload_hint: "Carica Fronte (Foto/PDF)", ai_check_note: "ðŸ¤– Verifica AI attiva.",
        btn_next: "Avanti", btn_back: "Indietro",
        h_company: "Profilo Aziendale", sub_company: "Dati per fatturazione.",
        lbl_company_name: "Ragione Sociale", lbl_vat: "Partita IVA", lbl_sdi: "SDI / PEC", lbl_address: "Sede Legale", lbl_site: "Sito Web",
        h_plan: "Scegli Piano", sub_plan: "SaaS Enterprise.", plan_monthly_desc: "Fatturazione mensile", plan_yearly_desc: "Risparmia 20%",
        h_checkout: "Pagamento", sub_checkout: "Accetta e paga.", summary_plan: "Totale da pagare",
        legal_privacy: "Accetto la <a href='#'>Privacy Policy</a> (GDPR).", legal_terms: "Accetto <a href='#'>Termini e Condizioni</a>.", legal_ai: "Autorizzo analisi AI per KYC.",
        btn_pay: "ðŸ”’ Paga e Attiva"
      },
      en: {
        access_denied_title: "Access Denied", access_denied_desc: "Interface available only via Bot.", open_bot: "Open Bot",
        step_identity: "Identity", step_company: "Company", step_plan: "Plan", step_checkout: "Checkout",
        h_identity: "Identity Verification", sub_identity: "Referent data for KYC.",
        lbl_name: "Name", lbl_surname: "Surname", lbl_email: "Email (Login)", lbl_phone: "Mobile",
        lbl_id_card: "ID Document", upload_hint: "Upload Front (Photo/PDF)", ai_check_note: "ðŸ¤– AI Verification active.",
        btn_next: "Next", btn_back: "Back",
        h_company: "Company Profile", sub_company: "Billing details.",
        lbl_company_name: "Company Name", lbl_vat: "VAT Number", lbl_sdi: "Tax ID / Code", lbl_address: "Registered Address", lbl_site: "Website",
        h_plan: "Select Plan", sub_plan: "Enterprise SaaS.", plan_monthly_desc: "Monthly billing", plan_yearly_desc: "Save 20%",
        h_checkout: "Checkout", sub_checkout: "Accept and pay.", summary_plan: "Total due",
        legal_privacy: "I accept <a href='#'>Privacy Policy</a> (GDPR).", legal_terms: "I accept <a href='#'>Terms & Conditions</a>.", legal_ai: "Authorize AI analysis for KYC.",
        btn_pay: "ðŸ”’ Pay & Activate"
      }
      // Aggiungi FR, DE, ES, PT qui seguendo lo schema...
    };

    // --- DOM ---
    const dom = {
      loader: document.getElementById('loader'),
      denied: document.getElementById('access-denied'),
      app: document.getElementById('app-content'),
      steps: [document.getElementById('step-1'), document.getElementById('step-2'), document.getElementById('step-3'), document.getElementById('step-4')],
      dots: [document.getElementById('si-1'), document.getElementById('si-2'), document.getElementById('si-3'), document.getElementById('si-4')],
      progressFill: document.getElementById('progress-fill'),
      fileInput: document.getElementById('id_document'),
      fileBox: document.getElementById('id-upload-box'),
      fileText: document.getElementById('id-upload-text'),
      sumPrice: document.getElementById('summary-price')
    };

    // --- LOGIC ---
    let currentStep = 1;
    let currentLang = 'it';
    
    // 1. INIT & AUTH CHECK
    const urlParams = new URLSearchParams(window.location.search);
    const chatId = urlParams.get('chat_id') || tg.initDataUnsafe?.user?.id;
    const threadId = urlParams.get('thread_id');

    if (!chatId) {
      dom.loader.style.display = 'none';
      dom.denied.classList.remove('hidden');
    } else {
      // Load user data from TG
      const user = tg.initDataUnsafe?.user;
      if(user) {
         document.getElementById('name').value = user.first_name || '';
         document.getElementById('surname').value = user.last_name || '';
         // Auto-detect language
         if(user.language_code && ['it','en','fr','de','es','pt'].includes(user.language_code)) {
            document.getElementById('lang-selector').value = user.language_code;
            changeLanguage(user.language_code);
         }
      }
      dom.loader.style.display = 'none';
      dom.app.classList.remove('hidden');
    }

    // 2. LANGUAGE
    function changeLanguage(lang) {
      currentLang = lang;
      const dict = i18n[lang] || i18n['en'];
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if(dict[key]) el.innerHTML = dict[key];
      });
    }

    // 3. NAVIGATION
    window.nextStep = function(step) {
      // Simple validation for current step
      if(step > currentStep) {
        const activeInputs = dom.steps[currentStep-1].querySelectorAll('input[required]');
        for(let input of activeInputs) {
          if(!input.value) { input.focus(); return; }
        }
      }

      currentStep = step;
      
      // Update UI
      dom.steps.forEach(s => s.classList.add('hidden'));
      dom.steps[step-1].classList.remove('hidden');
      
      // Update Progress
      const percent = ((step - 1) / 3) * 100;
      dom.progressFill.style.width = percent + "%";
      
      dom.dots.forEach((d, idx) => {
        if(idx < step) d.classList.add('active'); else d.classList.remove('active');
        if(idx < step-1) d.classList.add('completed'); else d.classList.remove('completed');
      });
    }

    // 4. FILE UPLOAD UX
    dom.fileInput.addEventListener('change', (e) => {
      if(e.target.files.length > 0) {
        dom.fileBox.classList.add('has-file');
        dom.fileText.innerText = `âœ… ${e.target.files[0].name}`;
      }
    });

    // 5. PLAN SELECTION
    window.selectPlan = function(type, el) {
      document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('selected'));
      el.classList.add('selected');
      document.getElementById('selected_plan').value = type;
      dom.sumPrice.innerText = type === 'monthly' ? "â‚¬99 / month" : "â‚¬950 / year";
    }

    // 6. SUBMIT (CHECKOUT)
    document.getElementById('wizardForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      btn.innerText = "Processing...";

      // Base64 File
      let idFileBase64 = null;
      if(dom.fileInput.files.length > 0) {
        idFileBase64 = await toBase64(dom.fileInput.files[0]);
      }

      // Address Compose
      const address = `${document.getElementById('addr_route').value} ${document.getElementById('addr_num').value}, ${document.getElementById('addr_zip').value} ${document.getElementById('addr_city').value} (${document.getElementById('addr_prov').value})`;

      const payload = {
        action: 'payment_checkout',
        chat_id: chatId,
        thread_id: threadId,
        owner_data: {
            user_id: chatId,
            name: document.getElementById('name').value,
            surname: document.getElementById('surname').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            ragione_sociale: document.getElementById('ragione_sociale').value,
            vat_number: document.getElementById('vat_number').value,
            sdi_pec: document.getElementById('sdi_pec').value,
            indirizzo: address,
            site: document.getElementById('site').value,
            lenguage: currentLang,
            kyc_document: idFileBase64, // FILE PER AI CHECK
            plan: document.getElementById('selected_plan').value
        }
      };

      try {
        const res = await fetch(WEBHOOK_URL, {
            method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload)
        });
        const data = await res.json();
        
        if(data.checkout_url) {
            window.location.href = data.checkout_url;
        } else {
            alert("Error creating checkout session.");
            btn.disabled = false;
        }
      } catch(err) {
        alert("Connection error.");
        btn.disabled = false;
      }
    });

    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = error => reject(error);
    });

  </script>
</body>
</html>
