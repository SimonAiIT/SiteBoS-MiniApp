<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Specchio Magico AI - SiteBoS</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="./specchio-magico-styles.css">
</head>
<body>

  <div id="loader" class="hidden">
    <div class="spinner-ring"></div>
    <div style="margin-top:10px; opacity:0.7; text-align:center;" id="loader-text">Caricamento...</div>
  </div>

  <div class="container" id="app-content">
    
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--glass-border);">
        <div>
            <h1 style="font-size: 22px; margin: 0;">
                <i class="fas fa-magic" style="color: var(--warning);"></i>
                Specchio Magico AI
            </h1>
            <p class="subtitle">Studio look professionale</p>
        </div>
        <button class="btn-icon" onclick="openBrandSettings()" title="Impostazioni Brand" id="settings-btn" style="display: none;">
            <i class="fas fa-cog"></i>
        </button>
    </div>

    <!-- UNLOCK -->
    <div id="unlock-check" class="card">
        <div style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 64px; color: var(--warning); margin-bottom: 20px;">
                <i class="fas fa-magic"></i>
            </div>
            <h2 style="margin-bottom: 15px;">Sblocca Specchio Magico</h2>
            <p style="color: var(--text-muted); line-height: 1.6; max-width: 400px; margin: 0 auto 30px;">
                Sistema colorimetria professionale multi-brand con traduttore universale.
            </p>
            
            <div class="note note-warning" style="text-align: center; margin-bottom: 30px;">
                <div style="font-size: 36px; font-weight: bold; margin-bottom: 5px;">
                    15.000 crediti
                </div>
                <div style="font-size: 12px; text-transform: uppercase;">
                    Sblocco Permanente (~33‚Ç¨)
                </div>
            </div>
            
            <button class="btn" onclick="unlockFeature()">
                <i class="fas fa-unlock"></i> Sblocca Ora
            </button>
        </div>
    </div>

    <!-- ONBOARDING: BRAND SELECTION -->
    <div id="brand-selection" class="hidden">
        <div class="card">
            <h2 style="margin: 0 0 10px 0;">üéØ Calibrazione Colorimetria</h2>
            <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 25px;">
                Seleziona il tuo brand principale per adattare la numerazione
            </p>

            <div class="brand-system-grid">
                <!-- Sistema Standard -->
                <div class="brand-system-card" onclick="selectSystem('standard')">
                    <div class="system-badge" style="background: var(--primary);">Standard</div>
                    <h3>üåç Sistema Internazionale</h3>
                    <div class="system-example">
                        <div class="example-code">7.2</div>
                        <div class="example-label">Biondo Iris√©</div>
                    </div>
                    <div class="brand-logos">
                        <span class="brand-tag">L'Or√©al</span>
                        <span class="brand-tag">Inoa</span>
                        <span class="brand-tag">Alfaparf</span>
                        <span class="brand-tag">Fanola</span>
                        <span class="brand-tag">Revlon</span>
                        <span class="brand-tag">Davines</span>
                    </div>
                    <div class="system-key">
                        <strong>Chiave:</strong> .2=Viola | .6=Rosso | .7=Verde
                    </div>
                </div>

                <!-- Sistema Tedesco -->
                <div class="brand-system-card" onclick="selectSystem('german')">
                    <div class="system-badge" style="background: var(--warning);">Tedesco</div>
                    <h3>üá©üá™ Sistema Invertito</h3>
                    <div class="system-example">
                        <div class="example-code">7/6</div>
                        <div class="example-label">Biondo Iris√©</div>
                    </div>
                    <div class="brand-logos">
                        <span class="brand-tag">Wella</span>
                        <span class="brand-tag">Schwarzkopf</span>
                        <span class="brand-tag">Londa</span>
                        <span class="brand-tag">Kadus</span>
                        <span class="brand-tag">Igora</span>
                    </div>
                    <div class="system-key">
                        <strong>Chiave:</strong> /6=Viola | /4=Rosso | /2=Verde
                    </div>
                </div>

                <!-- Sistema Alfabetico -->
                <div class="brand-system-card" onclick="selectSystem('alphabetic')">
                    <div class="system-badge" style="background: var(--success);">Lettere</div>
                    <h3>üá∫üá∏ Sistema Alfabetico</h3>
                    <div class="system-example">
                        <div class="example-code">7V</div>
                        <div class="example-label">Biondo Iris√©</div>
                    </div>
                    <div class="brand-logos">
                        <span class="brand-tag">Matrix</span>
                        <span class="brand-tag">Redken</span>
                        <span class="brand-tag">Goldwell</span>
                        <span class="brand-tag">Joico</span>
                        <span class="brand-tag">CHI</span>
                    </div>
                    <div class="system-key">
                        <strong>Chiave:</strong> V=Viola | R=Rosso | M=Verde
                    </div>
                </div>
            </div>

            <button class="btn btn-secondary" onclick="showDetailedBrandList()" style="margin-top: 20px; width: 100%;">
                <i class="fas fa-list"></i> Vedi Lista Completa Brand
            </button>
        </div>
    </div>

    <!-- GENDER SELECTION -->
    <div id="gender-section" class="hidden">
        <div class="card">
            <h3 style="margin: 0 0 15px 0;">üë§ Seleziona Genere Cliente</h3>
            <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 20px;">
                Questo determiner√† le opzioni di styling disponibili
            </p>
            
            <div class="gender-grid">
                <div class="gender-btn" onclick="selectGender('F')" id="gender-f">
                    <i class="fas fa-venus" style="color: var(--warning);"></i>
                    <span class="label">Donna</span>
                </div>
                
                <div class="gender-btn" onclick="selectGender('M')" id="gender-m">
                    <i class="fas fa-mars" style="color: var(--primary);"></i>
                    <span class="label">Uomo</span>
                </div>
                
                <div class="gender-btn" onclick="selectGender('X')" id="gender-x">
                    <i class="fas fa-genderless" style="color: var(--success);"></i>
                    <span class="label">Fluid</span>
                </div>
            </div>
        </div>
        
        <button class="btn" onclick="startCamera()" style="margin-top: 15px; width: 100%;" id="btn-start-camera" disabled>
            <i class="fas fa-camera"></i> Scatta Foto Cliente
        </button>
    </div>

    <!-- CAMERA -->
    <div id="camera-section" class="hidden">
        <div class="note" style="margin-bottom: 20px;">
            <i class="fas fa-info-circle"></i> <strong>Consigli:</strong> Viso frontale, buona illuminazione, sfondo neutro
        </div>
        
        <div class="card">
            <div class="camera-container">
                <video id="video-preview" autoplay playsinline></video>
                <canvas id="canvas-preview"></canvas>
                
                <div class="camera-controls">
                    <button class="camera-toggle" onclick="toggleCamera()" title="Cambia Camera">
                        <i class="fas fa-sync-alt" style="font-size: 20px;"></i>
                    </button>
                    
                    <button class="capture-btn" onclick="capturePhoto()" title="Scatta Foto">
                        <i class="fas fa-camera" style="font-size: 28px; color: var(--primary);"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <button class="btn btn-secondary" onclick="cancelCamera()" style="margin-top: 15px; width: 100%;">
            <i class="fas fa-times"></i> Annulla
        </button>
    </div>

    <!-- CONFIGURATION DASHBOARD -->
    <div id="config-section" class="hidden">
        <div class="card">
            <img id="client-photo" style="width: 100%; border-radius: 12px;">
        </div>

        <div class="card" style="margin-top: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div>
                    <h3 style="margin: 0;">üé® Configurazione Look</h3>
                    <p style="color: var(--text-muted); font-size: 13px; margin: 5px 0 0 0;">
                        Genere: <strong id="selected-gender-label">-</strong>
                    </p>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase;">Sistema</div>
                    <div style="font-size: 13px; font-weight: 600; color: var(--primary);" id="current-system-label">-</div>
                </div>
            </div>

            <!-- CAPELLI -->
            <div class="section-header">
                <i class="fas fa-cut" style="color: var(--warning); font-size: 20px;"></i>
                <h4>Capelli</h4>
            </div>

            <label class="input-label">Tipo Taglio</label>
            <select id="haircut" class="input"></select>

            <!-- COLOR COMPOSER -->
            <div class="color-composer">
                <label class="input-label">Altezza Tono Base</label>
                <div class="tone-slider-container">
                    <input type="range" id="base-tone" min="1" max="10" value="7" class="tone-slider" oninput="updateToneDisplay()">
                    <div class="tone-display" id="tone-display">7</div>
                </div>
                <div class="tone-labels">
                    <span>1<br>Nero</span>
                    <span>5<br>Castano</span>
                    <span>10<br>Platino</span>
                </div>
            </div>

            <label class="input-label" style="margin-top: 20px;">Riflessi</label>
            <div class="reflect-palette" id="reflect-palette">
                <!-- Populated by JS -->
            </div>

            <!-- FORMULA DISPLAY -->
            <div class="formula-display">
                <div class="formula-label">FORMULA COLORE</div>
                <div class="formula-code" id="formula-code">7</div>
                <div class="formula-meta">
                    <span id="formula-temp" class="temp-badge">NEUTRO</span>
                    <span id="formula-name" style="font-size: 13px; color: var(--text-muted);">Naturale</span>
                </div>
            </div>

            <!-- MAKEUP -->
            <div id="makeup-section" class="hidden">
                <div class="section-header">
                    <i class="fas fa-paint-brush" style="color: var(--warning); font-size: 20px;"></i>
                    <h4>Trucco</h4>
                </div>

                <label class="input-label">Occhi</label>
                <select id="eye-makeup" class="input">
                    <option value="none">Nessuno</option>
                    <option value="natural">Naturale Nude</option>
                    <option value="soft-glam">Soft Glam</option>
                    <option value="smokey">Smokey Eyes</option>
                    <option value="cat">Cat Eye</option>
                    <option value="graphic">Graphic Liner</option>
                    <option value="glitter">Glitter</option>
                    <option value="cut-crease">Cut Crease</option>
                    <option value="halo">Halo Eyes</option>
                    <option value="editorial">Editorial</option>
                </select>

                <label class="input-label" style="margin-top: 15px;">Labbra</label>
                <div class="makeup-grid" id="lip-colors">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- BEARD -->
            <div id="beard-section" class="hidden">
                <div class="section-header">
                    <i class="fas fa-user-tie" style="color: var(--primary); font-size: 20px;"></i>
                    <h4>Barba</h4>
                </div>

                <label class="input-label">Stile</label>
                <select id="beard-style" class="input">
                    <option value="none">Rasato</option>
                    <option value="stubble-1">Barba Incolta 1-2 giorni</option>
                    <option value="stubble-3">Barba Incolta 3-5 giorni</option>
                    <option value="short">Barba Corta (5-15mm)</option>
                    <option value="medium">Barba Media (15-25mm)</option>
                    <option value="full">Barba Piena (25mm+)</option>
                    <option value="goatee">Pizzetto</option>
                    <option value="van-dyke">Van Dyke</option>
                    <option value="circle">Circle Beard</option>
                    <option value="anchor">Anchor</option>
                </select>

                <label class="input-label" style="margin-top: 15px;">Colore Barba</label>
                <div class="makeup-grid" id="beard-colors">
                    <!-- Populated by JS -->
                </div>
            </div>

            <button class="btn" onclick="generatePreview()" style="margin-top: 30px; width: 100%;">
                <i class="fas fa-magic"></i> Genera Anteprima
            </button>
        </div>
    </div>

    <!-- RESULTS -->
    <div id="results-section" class="hidden">
        <div class="card">
            <h3 style="margin: 0 0 15px 0;">üé® Anteprima Look</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div>
                    <div class="preview-label">Prima</div>
                    <img id="before-img" class="preview-image">
                </div>
                <div>
                    <div class="preview-label">Dopo</div>
                    <div id="after-img" class="preview-placeholder">
                        <i class="fas fa-magic"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="card" style="margin-top: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0;">üìã Riepilogo Look</h3>
                <button class="btn-icon" onclick="translateFormula()" title="Traduci Formula">
                    <i class="fas fa-language"></i>
                </button>
            </div>
            <div id="summary-content"></div>
        </div>

        <div class="btn-container" style="margin-top: 15px;">
            <button class="btn btn-secondary" onclick="backToConfig()">
                <i class="fas fa-edit"></i> Modifica
            </button>
            
            <button class="btn" onclick="saveLook()">
                <i class="fas fa-save"></i> Salva
            </button>
            
            <button class="btn" onclick="shareLook()">
                <i class="fas fa-share-alt"></i> Condividi
            </button>
        </div>
    </div>

  </div>

  <!-- BRAND LIST MODAL -->
  <div id="brand-list-modal" class="modal-overlay hidden">
    <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
      <h3 style="margin: 0 0 20px 0;">üéØ Lista Completa Brand</h3>
      
      <div id="brand-list-container">
        <!-- Populated by JS -->
      </div>
      
      <button class="btn btn-secondary" onclick="closeBrandListModal()" style="margin-top: 20px; width: 100%;">
        <i class="fas fa-times"></i> Chiudi
      </button>
    </div>
  </div>

  <!-- TRANSLATION MODAL -->
  <div id="translation-modal" class="modal-overlay hidden">
    <div class="modal-content" style="max-width: 500px;">
      <h3 style="margin: 0 0 15px 0;">üåé Traduttore Universale</h3>
      
      <div class="translation-card">
        <div class="translation-label">La tua formula</div>
        <div class="translation-code" id="your-formula">-</div>
        <div class="translation-system" id="your-system">-</div>
      </div>

      <div style="text-align: center; margin: 20px 0;">
        <i class="fas fa-exchange-alt" style="font-size: 24px; color: var(--primary);"></i>
      </div>

      <div class="translation-card">
        <div class="translation-label">Traduzione universale</div>
        <div class="translation-code" id="universal-formula">-</div>
        <div class="translation-desc" id="universal-desc">-</div>
      </div>

      <div style="margin-top: 20px;" id="alternative-systems">
        <!-- Populated by JS -->
      </div>
      
      <button class="btn btn-secondary" onclick="closeTranslationModal()" style="margin-top: 20px; width: 100%;">
        <i class="fas fa-times"></i> Chiudi
      </button>
    </div>
  </div>

  <div class="fab-container">
    <button class="fab-btn fab-secondary" onclick="goBack()" title="Torna Indietro">
      <i class="fas fa-arrow-left"></i>
    </button>
  </div>

  <script src="./specchio-magico.js"></script>

</body>
</html>