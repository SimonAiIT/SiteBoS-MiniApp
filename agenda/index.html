<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Resource Orchestrator - SiteBoS</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="container">
        
        <!-- ========================================
             FASE A: SMART LOADER & AI ARCHITECT
             ======================================== -->
        <div id="smart-loader">
            <div class="loader-container">
                <div class="spinner-ring"></div>
                <h2 style="margin: 15px 0 10px 0;">üß† AI Architect</h2>
                <p id="loader-status" style="color: var(--text-muted); font-size: 14px; margin-bottom: 20px;">
                    Inizializzazione...
                </p>
                
                <!-- Progress Steps Visual -->
                <div style="background: rgba(0,0,0,0.2); border-radius: 8px; padding: 15px; margin-top: 15px;">
                    <div class="status-log" id="ai-log" style="min-height: 100px; max-height: 150px; overflow-y: auto;">
                        <div style="opacity: 0.5;">‚Üí Connessione al backend...</div>
                    </div>
                </div>

                <!-- Debug Info (Hidden by default) -->
                <div id="debug-info" class="hidden" style="margin-top: 15px; font-size: 11px; color: var(--text-secondary);">
                    <details>
                        <summary style="cursor: pointer; color: var(--primary);">üîç Debug Info</summary>
                        <pre id="debug-data" style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 4px; margin-top: 8px; white-space: pre-wrap; word-wrap: break-word;"></pre>
                    </details>
                </div>
            </div>
        </div>

        <!-- ========================================
             HIDDEN CONTAINERS (Revealed by Logic)
             ======================================== -->
        
        <!-- Wizard Container -->
        <div id="wizard-container" class="hidden">
            <!-- Loaded dynamically or redirect to wizard.html -->
        </div>

        <!-- Dossier Container -->
        <div id="dossier-container" class="hidden">
            <!-- Loaded dynamically or redirect to dossier.html -->
        </div>

        <!-- Calendar Container -->
        <div id="calendar-container" class="hidden">
            <!-- Loaded dynamically or redirect to calendar.html -->
        </div>

    </div>

    <!-- Error Overlay -->
    <div id="error-overlay" class="hidden">
        <div style="text-align: center; max-width: 400px;">
            <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: var(--error); margin-bottom: 20px;"></i>
            <h2 style="margin-bottom: 15px;">Errore di Connessione</h2>
            <p id="error-message" style="color: var(--text-muted); margin-bottom: 25px; line-height: 1.6;">
                Non √® stato possibile contattare il backend.
            </p>
            <button class="btn btn-secondary" onclick="location.reload()">
                <i class="fas fa-redo"></i> Riprova
            </button>
            <button class="btn" onclick="window.history.back()" style="margin-top: 10px;">
                <i class="fas fa-arrow-left"></i> Torna alla Dashboard
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../url-params-manager.js"></script>
    <script src="orchestrator_logic.js"></script>
    
    <script>
        // Initialize Telegram WebApp
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
        }

        // Start Smart Entry Flow
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Smart Resource Orchestrator - Starting...');
            SmartOrchestrator.init();
        });
    </script>
</body>
</html>