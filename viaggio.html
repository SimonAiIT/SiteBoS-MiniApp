<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Informazioni di Viaggio</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', 'Helvetica Neue', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #4a5b8f 0%, #3d4f7a 50%, #2a3d5f 100%);
      color: #ffffff;
      padding: 20px;
      padding-bottom: 100px;
      line-height: 1.5;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><path d="M0,400 Q300,200 600,400 T1200,400" stroke="rgba(255,255,255,0.1)" stroke-width="2" fill="none"/><path d="M0,500 Q300,300 600,500 T1200,500" stroke="rgba(255,255,255,0.08)" stroke-width="2" fill="none"/></svg>') no-repeat center;
      background-size: cover;
      pointer-events: none;
      z-index: -1;
    }
    
    .close-hint {
      position: fixed;
      top: 12px;
      right: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: rgba(255, 255, 255, 0.7);
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s;
      z-index: 100;
    }
    
    .close-hint:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
      color: rgba(255, 255, 255, 0.9);
    }
    
    .container {
      max-width: 500px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }
    
    h1 {
      font-size: 28px;
      margin-bottom: 8px;
      color: #ffffff;
      font-weight: 600;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }
    
    .subtitle {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 32px;
      font-weight: 300;
    }
    
    .form-group {
      margin-bottom: 20px;
      position: relative;
    }
    
    label {
      display: block;
      margin-bottom: 10px;
      color: rgba(255, 255, 255, 0.9);
      font-size: 14px;
      font-weight: 500;
      letter-spacing: 0.3px;
    }
    
    input, textarea, select {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      color: #ffffff;
      font-size: 15px;
      font-family: inherit;
      transition: all 0.3s ease;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    input::placeholder, textarea::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    
    select {
      cursor: pointer;
    }
    
    select option {
      background: #2a3d5f;
      color: #ffffff;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.5);
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 0 8px 32px rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
    }
    
    textarea {
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }
    
    .hint {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 6px;
      font-weight: 300;
    }
    
    .required::after {
      content: " *";
      color: #ff6b6b;
    }
    
    input[type="number"] {
      -moz-appearance: textfield;
    }
    
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    .button-container {
      margin-top: 32px;
      display: flex;
      justify-content: center;
    }
    
    #submitBtn {
      padding: 14px 48px;
      background: linear-gradient(135deg, #5B6FED 0%, #7B8FF5 100%);
      color: #ffffff;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 8px 24px rgba(91, 111, 237, 0.4);
    }
    
    #submitBtn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(91, 111, 237, 0.6);
    }
    
    #submitBtn:active:not(:disabled) {
      transform: translateY(0);
    }
    
    #submitBtn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-loading {
      position: relative;
    }
    
    .btn-loading::after {
      content: '';
      position: absolute;
      width: 14px;
      height: 14px;
      right: 16px;
      margin: auto;
      border: 2px solid transparent;
      border-radius: 50%;
      border-top-color: #ffffff;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .form-group {
      animation: slideIn 0.5s ease-out forwards;
    }
    
    .form-group:nth-child(1) { animation-delay: 0.05s; }
    .form-group:nth-child(2) { animation-delay: 0.1s; }
    .form-group:nth-child(3) { animation-delay: 0.15s; }
    .form-group:nth-child(4) { animation-delay: 0.2s; }
    .form-group:nth-child(5) { animation-delay: 0.25s; }
    .form-group:nth-child(6) { animation-delay: 0.3s; }
    .form-group:nth-child(7) { animation-delay: 0.35s; }
    .form-group:nth-child(8) { animation-delay: 0.4s; }
    
    .button-container {
      animation: slideIn 0.5s ease-out 0.45s forwards;
      opacity: 0;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @media (max-width: 480px) {
      h1 {
        font-size: 24px;
      }
      
      input, textarea, select, button {
        padding: 12px 14px;
        font-size: 14px;
      }
      
      .close-hint {
        font-size: 11px;
        padding: 6px 10px;
      }
    }
  </style>
</head>
<body>
  <div class="close-hint" id="closeHint">‚úï Chiudi</div>
  
  <div class="container">
    <h1 id="title">‚úàÔ∏è Informazioni di Viaggio</h1>
    <p class="subtitle" id="subtitle">Pianifica il tuo viaggio</p>
    
    <form id="travelForm">
      <div class="form-group">
        <label for="partenza" class="required"><span id="lblPartenza">üìç Partenza</span></label>
        <input type="text" id="partenza" required>
      </div>
      
      <div class="form-group">
        <label for="escludiPartenza" class="required"><span id="lblEscludiPartenza">üö´ Escludi Partenza da Itinerario</span></label>
        <select id="escludiPartenza" required>
          <option value="">-- Seleziona --</option>
          <option value="SI">SI</option>
          <option value="NO">NO</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="arrivo" class="required"><span id="lblArrivo">üìç Arrivo</span></label>
        <input type="text" id="arrivo" required>
      </div>
      
      <div class="form-group">
        <label for="escludiArrivo" class="required"><span id="lblEscludiArrivo">üö´ Escludi Arrivo da Itinerario</span></label>
        <select id="escludiArrivo" required>
          <option value="">-- Seleziona --</option>
          <option value="SI">SI</option>
          <option value="NO">NO</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="notti" class="required"><span id="lblNotti">üåô Notti</span></label>
        <input type="number" id="notti" required min="1" max="365">
      </div>
      
      <div class="form-group">
        <label for="interessi" class="required"><span id="lblInteressi">‚ù§Ô∏è Interessi</span></label>
        <textarea id="interessi" required></textarea>
        <div class="hint" id="hintInteressi">Es: mare, relax, cibo, trekking</div>
      </div>
      
      <div class="form-group">
        <label for="adulti" class="required"><span id="lblAdulti">üë® Adulti</span></label>
        <input type="number" id="adulti" required min="1" max="20">
      </div>
      
      <div class="form-group">
        <label for="bambini"><span id="lblBambini">üë∂ Bambini</span></label>
        <input type="number" id="bambini" min="0" max="20">
        <div class="hint" id="hintBambini">Opzionale</div>
      </div>
      
      <div class="button-container">
        <button type="submit" id="submitBtn"></button>
      </div>
    </form>
  </div>

  <script>
    const translations = {
      it: {
        title: "‚úàÔ∏è Informazioni di Viaggio",
        subtitle: "Pianifica il tuo viaggio",
        lblPartenza: "üìç Partenza",
        lblEscludiPartenza: "üö´ Escludi Partenza da Itinerario",
        lblArrivo: "üìç Arrivo",
        lblEscludiArrivo: "üö´ Escludi Arrivo da Itinerario",
        lblNotti: "üåô Notti",
        lblInteressi: "‚ù§Ô∏è Interessi",
        hintInteressi: "Es: mare, relax, cibo, trekking",
        lblAdulti: "üë® Adulti",
        lblBambini: "üë∂ Bambini",
        hintBambini: "Opzionale",
        btnSubmit: "‚úÖ Invia Richiesta",
        btnLoading: "‚è≥ Invio...",
        btnSuccess: "‚úÖ Inviato!",
        alertSuccess: "‚úÖ Richiesta di viaggio inviata con successo!",
        closeHint: "‚úï Chiudi"
      },
      en: {
        title: "‚úàÔ∏è Travel Information",
        subtitle: "Plan your trip",
        lblPartenza: "üìç Departure",
        lblEscludiPartenza: "üö´ Exclude Departure from Itinerary",
        lblArrivo: "üìç Arrival",
        lblEscludiArrivo: "üö´ Exclude Arrival from Itinerary",
        lblNotti: "üåô Nights",
        lblInteressi: "‚ù§Ô∏è Interests",
        hintInteressi: "Ex: beach, relax, food, trekking",
        lblAdulti: "üë® Adults",
        lblBambini: "üë∂ Children",
        hintBambini: "Optional",
        btnSubmit: "‚úÖ Send Request",
        btnLoading: "‚è≥ Sending...",
        btnSuccess: "‚úÖ Sent!",
        alertSuccess: "‚úÖ Travel request sent successfully!",
        closeHint: "‚úï Close"
      },
      es: {
        title: "‚úàÔ∏è Informaci√≥n de Viaje",
        subtitle: "Planifica tu viaje",
        lblPartenza: "üìç Salida",
        lblEscludiPartenza: "üö´ Excluir Salida del Itinerario",
        lblArrivo: "üìç Llegada",
        lblEscludiArrivo: "üö´ Excluir Llegada del Itinerario",
        lblNotti: "üåô Noches",
        lblInteressi: "‚ù§Ô∏è Intereses",
        hintInteressi: "Ej: playa, relax, comida, senderismo",
        lblAdulti: "üë® Adultos",
        lblBambini: "üë∂ Ni√±os",
        hintBambini: "Opcional",
        btnSubmit: "‚úÖ Enviar Solicitud",
        btnLoading: "‚è≥ Enviando...",
        btnSuccess: "‚úÖ ¬°Enviado!",
        alertSuccess: "‚úÖ ¬°Solicitud de viaje enviada exitosamente!",
        closeHint: "‚úï Cerrar"
      },
      fr: {
        title: "‚úàÔ∏è Informations de Voyage",
        subtitle: "Planifiez votre voyage",
        lblPartenza: "üìç D√©part",
        lblEscludiPartenza: "üö´ Exclure D√©part de l'Itin√©raire",
        lblArrivo: "üìç Arriv√©e",
        lblEscludiArrivo: "üö´ Exclure Arriv√©e de l'Itin√©raire",
        lblNotti: "üåô Nuits",
        lblInteressi: "‚ù§Ô∏è Int√©r√™ts",
        hintInteressi: "Ex: plage, d√©tente, nourriture, randonn√©e",
        lblAdulti: "üë® Adultes",
        lblBambini: "üë∂ Enfants",
        hintBambini: "Optionnel",
        btnSubmit: "‚úÖ Envoyer Demande",
        btnLoading: "‚è≥ Envoi...",
        btnSuccess: "‚úÖ Envoy√©!",
        alertSuccess: "‚úÖ Demande de voyage envoy√©e avec succ√®s!",
        closeHint: "‚úï Fermer"
      },
      de: {
        title: "‚úàÔ∏è Reiseinformationen",
        subtitle: "Planen Sie Ihre Reise",
        lblPartenza: "üìç Abreise",
        lblEscludiPartenza: "üö´ Abreise aus Reiseroute ausschlie√üen",
        lblArrivo: "üìç Ankunft",
        lblEscludiArrivo: "üö´ Ankunft aus Reiseroute ausschlie√üen",
        lblNotti: "üåô N√§chte",
        lblInteressi: "‚ù§Ô∏è Interessen",
        hintInteressi: "Z.B.: Strand, Entspannung, Essen, Wandern",
        lblAdulti: "üë® Erwachsene",
        lblBambini: "üë∂ Kinder",
        hintBambini: "Optional",
        btnSubmit: "‚úÖ Anfrage Senden",
        btnLoading: "‚è≥ Wird gesendet...",
        btnSuccess: "‚úÖ Gesendet!",
        alertSuccess: "‚úÖ Reiseanfrage erfolgreich gesendet!",
        closeHint: "‚úï Schlie√üen"
      },
      pt: {
        title: "‚úàÔ∏è Informa√ß√µes de Viagem",
        subtitle: "Planeje sua viagem",
        lblPartenza: "üìç Partida",
        lblEscludiPartenza: "üö´ Excluir Partida do Itiner√°rio",
        lblArrivo: "üìç Chegada",
        lblEscludiArrivo: "üö´ Excluir Chegada do Itiner√°rio",
        lblNotti: "üåô Noites",
        lblInteressi: "‚ù§Ô∏è Interesses",
        hintInteressi: "Ex: praia, relaxamento, comida, trekking",
        lblAdulti: "üë® Adultos",
        lblBambini: "üë∂ Crian√ßas",
        hintBambini: "Opcional",
        btnSubmit: "‚úÖ Enviar Solicita√ß√£o",
        btnLoading: "‚è≥ Enviando...",
        btnSuccess: "‚úÖ Enviado!",
        alertSuccess: "‚úÖ Solicita√ß√£o de viagem enviada com sucesso!",
        closeHint: "‚úï Fechar"
      }
    };
    
    const N8N_WEBHOOK_URL = "https://trinai.api.workflow.dcmake.it/webhook/a0b6b2cb-4e19-4a92-9269-6b6d8a7afb80";
    
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();
    
    const urlParams = new URLSearchParams(window.location.search);
    const lang = urlParams.get('lang') || 'it';
    const chatId = urlParams.get('chatId');
    const threadId = urlParams.get('threadId');
    
    const t = translations[lang] || translations.it;
    
    function applyTranslations() {
      document.getElementById('title').textContent = t.title;
      document.getElementById('subtitle').textContent = t.subtitle;
      document.getElementById('lblPartenza').textContent = t.lblPartenza;
      document.getElementById('lblEscludiPartenza').textContent = t.lblEscludiPartenza;
      document.getElementById('lblArrivo').textContent = t.lblArrivo;
      document.getElementById('lblEscludiArrivo').textContent = t.lblEscludiArrivo;
      document.getElementById('lblNotti').textContent = t.lblNotti;
      document.getElementById('lblInteressi').textContent = t.lblInteressi;
      document.getElementById('hintInteressi').textContent = t.hintInteressi;
      document.getElementById('lblAdulti').textContent = t.lblAdulti;
      document.getElementById('lblBambini').textContent = t.lblBambini;
      document.getElementById('hintBambini').textContent = t.hintBambini;
      document.getElementById('submitBtn').textContent = t.btnSubmit;
      document.getElementById('closeHint').textContent = t.closeHint;
    }
    
    applyTranslations();
    
    const form = document.getElementById('travelForm');
    const submitBtn = document.getElementById('submitBtn');
    const closeHint = document.getElementById('closeHint');
    const requiredInputs = form.querySelectorAll('[required]');
    
    function validateForm() {
      const isValid = Array.from(requiredInputs).every(
        input => input.value.trim() !== '' && input.value !== ''
      );
      submitBtn.disabled = !isValid;
    }
    
    requiredInputs.forEach(input => {
      input.addEventListener('input', validateForm);
      input.addEventListener('change', validateForm);
    });
    
    validateForm();
    
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const formData = {
        chatId: chatId,
        threadId: threadId,
        partenza: document.getElementById('partenza').value.trim(),
        escludiPartenza: document.getElementById('escludiPartenza').value,
        arrivo: document.getElementById('arrivo').value.trim(),
        escludiArrivo: document.getElementById('escludiArrivo').value,
        notti: parseInt(document.getElementById('notti').value),
        interessi: document.getElementById('interessi').value.trim(),
        adulti: parseInt(document.getElementById('adulti').value),
        bambini: parseInt(document.getElementById('bambini').value) || 0,
        language: lang,
        timestamp: new Date().toISOString()
      };
      
      submitBtn.disabled = true;
      submitBtn.classList.add('btn-loading');
      const originalText = submitBtn.textContent;
      submitBtn.innerHTML = t.btnLoading;
      
      fetch(N8N_WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      }).then(() => {
        submitBtn.innerHTML = t.btnSuccess;
        tg.showAlert(t.alertSuccess);
        setTimeout(() => tg.close(), 1000);
      }).catch(() => {
        submitBtn.innerHTML = t.btnSuccess;
        tg.showAlert(t.alertSuccess);
        setTimeout(() => tg.close(), 1000);
      });
    });
    
    closeHint.addEventListener('click', () => tg.close());
  </script>
</body>
</html>
