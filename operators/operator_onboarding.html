<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Attivazione Operatore</title>
  
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- CSS CONDIVISO ROOT -->
  <link rel="stylesheet" href="../styles.css">
  
  <style>
    .skills-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
    @media (max-width: 600px) { .skills-grid { grid-template-columns: 1fr; } }
    
    .skill-item { display: flex; align-items: center; gap: 8px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; cursor: pointer; transition: all 0.2s; }
    .skill-item:hover { background: rgba(255,255,255,0.08); }
    .skill-item input[type="checkbox"] { margin: 0; }
    .skill-item.selected { background: rgba(91, 111, 237, 0.2); border: 1px solid var(--primary); }
    
    .level-selector { display: flex; gap: 6px; margin-top: 8px; }
    .level-btn { flex: 1; padding: 6px; font-size: 11px; border-radius: 6px; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.3); color: var(--text-muted); cursor: pointer; transition: all 0.2s; }
    .level-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
    
    .cert-input-group { display: flex; gap: 8px; margin-bottom: 8px; }
    .cert-input-group input { flex: 1; }
    .cert-input-group button { padding: 8px 12px; background: var(--danger); border: none; color: white; border-radius: 6px; cursor: pointer; }
    
    .cv-upload-card { background: linear-gradient(135deg, rgba(255, 193, 7, 0.2) 0%, rgba(255, 193, 7, 0.05) 100%); border-left: 3px solid #ffc107; margin-bottom: 20px; }
  </style>
</head>
<body>

  <!-- LOADER -->
  <div id="loader">
    <div class="spinner"></div>
    <div style="margin-top:10px; font-size:12px;">SECURE HANDSHAKE</div>
  </div>

  <!-- ACCESS DENIED -->
  <div id="access-denied" class="hidden container text-center" style="padding-top:50px;">
    <div style="font-size:50px; margin-bottom:20px;">ðŸ”’</div>
    <h2 data-i18n="access_denied_title">Accesso Riservato</h2>
    <p class="subtitle" data-i18n="access_denied_desc">Attivazione disponibile solo tramite invito.</p>
    <a href="https://t.me/TrinAi_Site_bot" class="btn btn-primary btn-block" data-i18n="open_bot">Contatta Owner</a>
  </div>

  <!-- APP CONTENT -->
  <div id="app-content" class="container hidden">
    <!-- Lang Selector -->
    <div style="display:flex; justify-content:flex-end; margin-bottom:10px;">
      <select id="lang-selector" class="lang-select">
        <option value="it">ðŸ‡®ðŸ‡¹ IT</option>
        <option value="en">ðŸ‡¬ðŸ‡§ EN</option>
        <option value="fr">ðŸ‡«ðŸ‡· FR</option>
        <option value="de">ðŸ‡©ðŸ‡ª DE</option>
        <option value="es">ðŸ‡ªðŸ‡¸ ES</option>
        <option value="pt">ðŸ‡µðŸ‡¹ PT</option>
      </select>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar">
      <div class="progress-line"></div>
      <div class="progress-fill" id="progress-fill"></div>
      
      <div class="step-item active" id="si-1">
        <div class="step-circle">1</div>
        <div class="step-label" data-i18n="step_identity">IdentitÃ </div>
      </div>
      <div class="step-item" id="si-2">
        <div class="step-circle">2</div>
        <div class="step-label" data-i18n="step_profile">Profilo</div>
      </div>
    </div>

    <form id="wizardForm" onsubmit="return false;">
      
      <!-- STEP 1: IDENTITÃ€ & SICUREZZA -->
      <div class="step-content fade-in" id="step-1">
        <h2 data-i18n="h_identity">Setup & Sicurezza</h2>
        <p class="subtitle" data-i18n="sub_identity">Consensi, Chiave API e Verifica IdentitÃ .</p>

        <!-- Welcome Message -->
        <div class="card" style="background: linear-gradient(135deg, rgba(91, 111, 237, 0.2) 0%, rgba(91, 111, 237, 0.05) 100%); border-left: 3px solid var(--primary); margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <i class="fas fa-user-plus" style="font-size: 32px; color: var(--primary);"></i>
            <div>
              <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">ðŸ‘‹ Benvenuto nel Team!</div>
              <div style="font-size: 13px; color: var(--text-secondary);">
                Sei stato invitato da <strong id="company-name-display">...</strong>
              </div>
            </div>
          </div>
        </div>

        <!-- GDPR -->
        <div class="legal-box form-section">
            <div class="checkbox-group"><input type="checkbox" id="chk_privacy"><label for="chk_privacy" data-i18n="legal_privacy">Accetto Privacy Policy</label></div>
            <div class="checkbox-group"><input type="checkbox" id="chk_terms"><label for="chk_terms" data-i18n="legal_terms">Accetto Termini di Servizio</label></div>
            <div class="checkbox-group"><input type="checkbox" id="chk_ai"><label for="chk_ai" data-i18n="legal_ai">Accetto uso AI (Gemini)</label></div>
        </div>

        <!-- BYOK GEMINI -->
        <div class="api-key-card form-section">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <div style="color:var(--primary); font-weight:bold;"><i class="fas fa-brain"></i> Gemini API Key</div>
                <a href="https://aistudio.google.com/api-keys" target="_blank" class="btn btn-sm btn-secondary" style="text-decoration:none;" data-i18n="btn_get_key">Ottieni Gratis</a>
            </div>
            <input type="text" id="gemini_key" placeholder="Incolla qui: AIzaSy..." required>
            <div class="hint" data-i18n="byok_note">La tua chiave personale, nessuno la vedrÃ .</div>
        </div>

        <!-- UPLOAD DOCUMENTO -->
        <div class="input-group">
          <label data-i18n="lbl_id_card">Documento IdentitÃ </label>
          <div class="upload-box" id="upload-box">
            <input type="file" id="id_document" accept="image/*,application/pdf">
            <div class="upload-icon" id="upload-icon"><i class="fas fa-id-card"></i></div>
            <div class="upload-text" id="upload-text" data-i18n="upload_lock">Carica documento per procedere</div>
          </div>
        </div>

        <!-- DATI ESTRATTI -->
        <div class="row">
          <div class="col"><label data-i18n="lbl_name">Nome</label><input type="text" id="name" readonly placeholder="..."></div>
          <div class="col"><label data-i18n="lbl_surname">Cognome</label><input type="text" id="surname" readonly placeholder="..."></div>
        </div>
        <div class="input-group"><label data-i18n="lbl_fiscal">Codice Fiscale</label><input type="text" id="fiscal_code" readonly placeholder="..."></div>
        <div class="input-group"><label class="required" data-i18n="lbl_email">Email</label><input type="email" id="email" required></div>
        <div class="input-group"><label class="required" data-i18n="lbl_phone">Telefono</label><input type="tel" id="phone" required></div>

        <div class="btn-container">
          <button type="button" class="btn btn-primary btn-block" id="btn-step1" disabled>
            <span data-i18n="btn_next">Avanti</span> <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>

      <!-- STEP 2: PROFILO PROFESSIONALE -->
      <div class="step-content hidden fade-in" id="step-2">
        <h2 data-i18n="h_profile">Profilo Professionale</h2>
        <p class="subtitle" data-i18n="sub_profile">Competenze e esperienza lavorativa.</p>

        <!-- ðŸš€ UPLOAD CV MAGIC -->
        <div class="card cv-upload-card">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <i class="fas fa-file-upload" style="font-size: 28px; color: #ffc107;"></i>
            <div>
              <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px;" data-i18n="cv_magic_title">âš¡ Risparmia tempo!</div>
              <div style="font-size: 12px; color: var(--text-secondary);" data-i18n="cv_magic_desc">
                Carica il tuo CV e compileremo tutto automaticamente
              </div>
            </div>
          </div>
          
          <input type="file" id="cv_upload" accept=".pdf,application/pdf" style="display:none;">
          <button type="button" class="btn btn-secondary btn-block" onclick="document.getElementById('cv_upload').click()">
            <i class="fas fa-upload"></i> <span data-i18n="btn_upload_cv">Carica CV (PDF)</span>
          </button>
          
          <div id="cv-status" class="hidden" style="margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px; font-size: 12px;">
            <div id="cv-status-text"></div>
          </div>
        </div>

        <!-- INDIRIZZO -->
        <div class="form-section">
          <div class="section-title"><i class="fas fa-map-marker-alt"></i> <span data-i18n="section_address">Indirizzo</span></div>
          <div class="row">
            <div class="col-2"><input type="text" id="addr_route" placeholder="Via/Piazza" required></div>
            <div class="col"><input type="text" id="addr_num" placeholder="NÂ°" required></div>
          </div>
          <div class="row">
            <div class="col"><input type="text" id="addr_zip" placeholder="CAP" required></div>
            <div class="col-2"><input type="text" id="addr_city" placeholder="CittÃ " required></div>
            <div class="col"><input type="text" id="addr_prov" placeholder="PR" maxlength="2" required></div>
          </div>
        </div>

        <!-- FORMAZIONE -->
        <div class="form-section">
          <div class="section-title"><i class="fas fa-graduation-cap"></i> <span data-i18n="section_education">Formazione</span></div>
          
          <div class="input-group">
            <label class="required" data-i18n="lbl_education">Titolo di Studio</label>
            <select id="education_level" required>
              <option value="">-- Seleziona --</option>
              <option value="middle_school">Licenza Media</option>
              <option value="high_school">Diploma Superiore</option>
              <option value="professional_diploma">Diploma Professionale</option>
              <option value="bachelor">Laurea Triennale</option>
              <option value="master">Laurea Magistrale</option>
              <option value="phd">Dottorato</option>
              <option value="other">Altro</option>
            </select>
          </div>
          
          <div class="input-group">
            <label data-i18n="lbl_education_field">Specializzazione / Indirizzo</label>
            <input type="text" id="education_field" placeholder="Es: Elettrotecnica, Meccanica, Informatica...">
          </div>
        </div>

        <!-- PROFILO LAVORATIVO -->
        <div class="form-section">
          <div class="section-title"><i class="fas fa-briefcase"></i> <span data-i18n="section_work">Esperienza Lavorativa</span></div>
          
          <div class="input-group">
            <label class="required" data-i18n="lbl_job_title">Ruolo / Mansione Principale</label>
            <input type="text" id="job_title" placeholder="Es: Elettricista, Idraulico, Tecnico..." required>
          </div>
          
          <!-- CHECKBOX PRIMA ESPERIENZA -->
          <div class="checkbox-group" style="margin-bottom: 15px;">
            <input type="checkbox" id="is_first_job">
            <label for="is_first_job">
              <strong data-i18n="lbl_first_job_ever">Ãˆ la mia prima esperienza lavorativa</strong>
            </label>
          </div>
          
          <div id="experience-fields">
            <div class="row">
              <div class="col">
                <label class="required" data-i18n="lbl_experience">Anni di Esperienza Totali</label>
                <select id="experience_years" required>
                  <option value="">-- Seleziona --</option>
                  <option value="0-1">Meno di 1 anno</option>
                  <option value="1-3">1-3 anni</option>
                  <option value="3-5">3-5 anni</option>
                  <option value="5-10">5-10 anni</option>
                  <option value="10-15">10-15 anni</option>
                  <option value="15+">Oltre 15 anni</option>
                </select>
              </div>
              
              <div class="col">
                <label class="required" data-i18n="lbl_first_job">Prima Esperienza</label>
                <input type="number" id="first_job_year" placeholder="Anno (es: 2015)" min="1970" max="2025" required>
              </div>
            </div>
          </div>
          
          <!-- RAPPORTO CON OWNER -->
          <div class="card" style="background: rgba(91, 111, 237, 0.1); border-left: 3px solid var(--primary); margin-top: 15px;">
            <div class="checkbox-group">
              <input type="checkbox" id="works_for_owner">
              <label for="works_for_owner">
                <strong data-i18n="lbl_works_owner">Lavoro giÃ  per questa azienda</strong>
              </label>
            </div>
            
            <div id="owner-work-details" class="hidden" style="margin-top: 12px;">
              <div class="input-group">
                <label data-i18n="lbl_years_with_owner">Da quanti anni lavori qui?</label>
                <select id="years_with_owner">
                  <option value="">-- Seleziona --</option>
                  <option value="0-1">Meno di 1 anno</option>
                  <option value="1-2">1-2 anni</option>
                  <option value="2-3">2-3 anni</option>
                  <option value="3-5">3-5 anni</option>
                  <option value="5-10">5-10 anni</option>
                  <option value="10+">Oltre 10 anni</option>
                </select>
              </div>
              
              <div class="input-group">
                <label data-i18n="lbl_collaboration">Tipo di collaborazione</label>
                <select id="collaboration_type">
                  <option value="">-- Seleziona --</option>
                  <option value="employee">Dipendente</option>
                  <option value="freelance">Collaboratore esterno</option>
                  <option value="contractor">Subappaltatore</option>
                  <option value="partner">Partner / Socio</option>
                  <option value="other">Altro</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- CERTIFICAZIONI -->
          <div class="input-group" style="margin-top: 15px;">
            <label data-i18n="lbl_certifications">Certificazioni / Patentini</label>
            <div id="certifications-list"></div>
            <button type="button" class="btn btn-sm btn-secondary" onclick="addCertification()">
              <i class="fas fa-plus"></i> <span data-i18n="btn_add_cert">Aggiungi Certificazione</span>
            </button>
          </div>
        </div>

        <!-- COMPETENZE AI -->
        <div class="form-section">
          <div class="section-title"><i class="fas fa-magic"></i> <span data-i18n="section_skills">Competenze Tecniche</span></div>
          
          <div class="input-group">
            <label class="required" data-i18n="lbl_work_desc">Descrivi la tua esperienza lavorativa</label>
            <textarea id="work_description" rows="4" placeholder="Es: Ho lavorato 5 anni come elettricista in cantieri civili e industriali. Ho installato oltre 20 impianti fotovoltaici, gestito quadri elettrici BT/MT..." required></textarea>
          </div>
          
          <button type="button" class="btn btn-primary btn-block" id="analyze-skills-btn" onclick="analyzeSkills()">
            <i class="fas fa-sparkles"></i> <span data-i18n="btn_analyze">Analizza Competenze con AI</span>
          </button>
          
          <div id="skills-result" class="hidden" style="margin-top: 15px;">
            <p class="hint" data-i18n="hint_skills_ai">âœ… Competenze estratte! Seleziona il livello per ognuna o rimuovila.</p>
            <div class="skills-grid" id="skills-grid"></div>
          </div>
          
          <div class="input-group mt-2">
            <label data-i18n="lbl_other_skills">Altre competenze (manuale)</label>
            <textarea id="other_skills" rows="2" placeholder="Aggiungi competenze non rilevate..."></textarea>
          </div>
        </div>

        <div class="btn-container">
          <button type="button" class="btn btn-secondary" id="btn-back-s2"><i class="fas fa-arrow-left"></i> <span data-i18n="btn_back">Indietro</span></button>
          <button type="button" class="btn btn-primary" id="submitBtn">
            <i class="fas fa-check"></i> <span data-i18n="btn_complete">Completa Attivazione</span>
          </button>
        </div>
      </div>

    </form>
  </div>
  
  <script src="operator_onboarding_logic.js"></script>
</body>
</html>